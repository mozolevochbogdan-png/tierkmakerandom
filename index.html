<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tier List Maker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --bg: #000000;
            --card: #1c1c1e;
            --accent: #32d74b; /* iOS Green */
            --text: #ffffff;
            --border: #38383a;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            margin: 0;
            padding: 0;
            -webkit-touch-callout: none;
        }

        /* –†–ï–î–ê–ö–¢–û–† (–ú–æ–±–∏–ª—å–Ω—ã–π –≤–∏–¥) */
        #editor-screen {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section {
            background: var(--card);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border);
        }

        h2 { margin: 0 0 15px 0; font-size: 1.2rem; }

        input[type="text"] {
            background: #2c2c2e;
            border: 1px solid var(--border);
            color: white;
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            box-sizing: border-box;
            font-size: 16px; /* –ß—Ç–æ–±—ã iOS –Ω–µ –∑—É–º–∏–ª */
            margin-bottom: 10px;
        }

        .tier-row-edit { display: flex; gap: 10px; margin-bottom: 10px; }
        
        .btn {
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            text-align: center;
        }

        .btn-add { background: #2c2c2e; color: white; width: 100%; border: 1px dashed var(--border); }
        .btn-main { background: var(--accent); color: black; width: 100%; margin-top: 20px; }
        .btn-del { background: #ff453a; color: white; padding: 10px 15px; }

        .img-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #2c2c2e;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        .img-item img { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; }

        /* –ò–ì–†–ê */
        #game-screen { display: none; padding: 10px; flex-direction: column; align-items: center; }

        .tier-board { width: 100%; border: 1px solid var(--border); border-radius: 10px; overflow: hidden; margin-top: 15px; }
        .tier-row { display: flex; min-height: 90px; border-bottom: 1px solid var(--border); }
        .tier-label { width: 80px; padding: 10px; display: flex; align-items: center; justify-content: center; text-align: center; font-weight: 900; font-size: 0.9rem; color: #000; }
        .tier-content { flex: 1; background: #121212; display: flex; flex-wrap: wrap; gap: 5px; padding: 5px; min-height: 90px; }
        .drag-over { background: #2c2c2e !important; }

        .game-img { width: 70px; height: 70px; object-fit: cover; border-radius: 4px; }

        /* –ù–ò–ñ–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ */
        .controls {
            position: fixed;
            bottom: 30px;
            background: rgba(28, 28, 30, 0.9);
            backdrop-filter: blur(20px);
            padding: 15px 25px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .deck {
            width: 60px;
            height: 80px;
            background: var(--accent);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: black;
            box-shadow: 0 0 15px var(--accent);
        }

        #active-slot {
            width: 75px;
            height: 75px;
            border: 2px dashed #444;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* REVEAL */
        #reveal-overlay {
            position: fixed;
            inset: 0;
            background: black;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .reveal-text { font-size: 3rem; font-weight: 900; text-align: center; margin-bottom: 20px; padding: 0 20px; }
        .reveal-img { max-width: 85vw; max-height: 50vh; border-radius: 15px; border: 4px solid white; }

        .tc-0 { background: #FF3B30; } .tc-1 { background: #FF9500; } .tc-2 { background: #FFCC00; }
        .tc-3 { background: #34C759; } .tc-4 { background: #007AFF; } .tc-5 { background: #AF52DE; }
    </style>
</head>
<body>

    <div id="editor-screen">
        <div class="section">
            <h2>üìù –ù–∞–∑–≤–∞–Ω–∏–µ</h2>
            <input type="text" id="inp-title" value="–ú–æ–π –¢–∏—Ä-–õ–∏—Å—Ç">
            
            <h2>üìä –í–∞—Ä–∏–∞–Ω—Ç—ã</h2>
            <div id="tier-inputs"></div>
            <button class="btn btn-add" onclick="addTierInput()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–∏—Ä</button>
        </div>

        <div class="section">
            <h2>üñºÔ∏è –§–æ—Ç–æ</h2>
            <input type="file" id="file-inp" multiple accept="image/*" style="display:none">
            <button class="btn btn-add" style="color: var(--accent);" onclick="document.getElementById('file-inp').click()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</button>
            <div id="img-edit-list" style="margin-top:15px"></div>
        </div>

        <button class="btn btn-main" onclick="start()">–°–û–•–†–ê–ù–ò–¢–¨ –ò –ò–ì–†–ê–¢–¨</button>
    </div>

    <div id="game-screen">
        <h1 id="display-title"></h1>
        <div style="display:flex; gap:10px; width:100%">
            <button class="btn btn-add" style="flex:1" onclick="share()">üîó –°—Å—ã–ª–∫–∞</button>
            <button class="btn btn-add" style="flex:1" onclick="download()">üì∑ –§–æ—Ç–æ</button>
        </div>

        <div id="board" class="tier-board"></div>

        <div class="controls">
            <div id="count-tag" style="font-size: 0.7rem; color: #888;"></div>
            <div class="deck" onclick="openCard()">?</div>
            <div id="active-slot" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        </div>
    </div>

    <div id="reveal-overlay" onclick="closeCard()">
        <div id="reveal-txt" class="reveal-text"></div>
        <img id="reveal-img" class="reveal-img">
        <p style="color:#444; margin-top:20px">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</p>
    </div>

    <script>
        let data = { title: "", tiers: ["S", "A", "B", "C"], images: [] };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∏—Ä–æ–≤
        function renderInputs() {
            const cont = document.getElementById('tier-inputs');
            cont.innerHTML = '';
            data.tiers.forEach((t, i) => {
                cont.innerHTML += `<div class="tier-row-edit">
                    <input type="text" value="${t}" oninput="data.tiers[${i}]=this.value">
                    <button class="btn btn-del" onclick="data.tiers.splice(${i},1); renderInputs()">‚úï</button>
                </div>`;
            });
        }
        function addTierInput() { data.tiers.push("–ù–æ–≤—ã–π"); renderInputs(); }
        renderInputs();

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
        document.getElementById('file-inp').onchange = function(e) {
            Array.from(e.target.files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    const obj = { id: Date.now()+Math.random(), src: ev.target.result, text: "" };
                    data.images.push(obj);
                    const div = document.createElement('div');
                    div.className = 'img-item';
                    div.innerHTML = `<img src="${obj.src}"><input type="text" placeholder="–¢–µ–∫—Å—Ç (–û–ø–∞–Ω–∞...)" oninput="updateImgText(${obj.id}, this.value)">`;
                    document.getElementById('img-edit-list').appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        };
        function updateImgText(id, val) { const im = data.images.find(x => x.id === id); if(im) im.text = val; }

        // –ó–∞–ø—É—Å–∫
        function start() {
            if(data.images.length === 0) return alert("–î–æ–±–∞–≤—å —Ñ–æ—Ç–æ!");
            data.title = document.getElementById('inp-title').value;
            document.getElementById('editor-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            document.getElementById('display-title').innerText = data.title;
            
            const board = document.getElementById('board');
            board.innerHTML = '';
            data.tiers.forEach((t, i) => {
                board.innerHTML += `<div class="tier-row">
                    <div class="tier-label tc-${i%6}">${t}</div>
                    <div class="tier-content" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                </div>`;
            });
            document.getElementById('count-tag').innerText = data.images.length;
        }

        // –ö–∞—Ä—Ç—ã
        let current = null;
        function openCard() {
            if(data.images.length === 0) return;
            current = data.images.shift();
            document.getElementById('count-tag').innerText = data.images.length;
            document.getElementById('reveal-img').src = current.src;
            document.getElementById('reveal-txt').innerText = current.text; // –¢–æ–ª—å–∫–æ —Ç–≤–æ–π —Ç–µ–∫—Å—Ç
            document.getElementById('reveal-overlay').style.display = 'flex';
        }

        function closeCard() {
            document.getElementById('reveal-overlay').style.display = 'none';
            const slot = document.getElementById('active-slot');
            slot.innerHTML = '';
            const img = document.createElement('img');
            img.src = current.src;
            img.className = 'game-img';
            img.id = 'token-' + Date.now();
            img.draggable = true;
            img.addEventListener('dragstart', e => {
                e.dataTransfer.setData("text", e.target.id);
                e.target.style.opacity = "0.5";
            });
            img.addEventListener('dragend', e => e.target.style.opacity = "1");
            slot.appendChild(img);
        }

        // Drag n Drop
        function allowDrop(e) { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
        function drop(e) {
            e.preventDefault();
            const id = e.dataTransfer.getData("text");
            const el = document.getElementById(id);
            let target = e.target;
            while(target && !target.classList.contains('tier-content') && target.id !== 'active-slot') target = target.parentElement;
            if(target) target.appendChild(el);
            document.querySelectorAll('.drag-over').forEach(x => x.classList.remove('drag-over'));
        }

        // –ü–æ–¥–µ–ª–∏—Ç—å—Å—è (–ø–µ—Ä–µ–¥–∞–µ—Ç —à–∞–±–ª–æ–Ω)
        function share() {
            const config = btoa(unescape(encodeURIComponent(JSON.stringify({
                t: data.title,
                r: data.tiers
            }))));
            const url = window.location.origin + window.location.pathname + "?c=" + config;
            navigator.clipboard.writeText(url).then(() => alert("–°—Å—ã–ª–∫–∞-—à–∞–±–ª–æ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!"));
        }

        function download() {
            html2canvas(document.getElementById('board')).then(canvas => {
                const a = document.createElement('a');
                a.download = 'tier-list.png';
                a.href = canvas.toDataURL();
                a.click();
            });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Å—ã–ª–∫–∏ –ø—Ä–∏ –≤—Ö–æ–¥–µ
        const params = new URLSearchParams(window.location.search);
        if(params.has('c')) {
            try {
                const conf = JSON.parse(decodeURIComponent(escape(atob(params.get('c')))));
                document.getElementById('inp-title').value = conf.t;
                data.tiers = conf.r;
                renderInputs();
            } catch(e) {}
        }
    </script>
</body>
</html>
